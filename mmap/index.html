<!doctype html>
<html>

  <head>
<meta charset="utf-8">
<link rel="stylesheet" href="style.css"/>
<title>Mmap</title>
<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script>
	var stuff;
	var xhr;
	var myLat = 0;
	var myLng = 0;
	function initialize() {
	if (navigator.geolocation) { // the navigator.geolocation object is supported on your browser
		navigator.geolocation.getCurrentPosition(function(position) {
		
		myLat = position.coords.latitude;
		myLng = position.coords.longitude;
//		console.log("3. Leaving the function(position)... "+ myLat + " " + myLng);
		getdata();
		setup();
		if (xhr.readyState == 4 && xhr.status == 200) {
		stuff.forEach(function(val, index, theArray) {
				login=val.login;
				lat=value.lat;
				lng=value.lng;	
				var landmark = new google.maps.LatLng(lat, lng);
				// Create a marker				
				var mark = new google.maps.Marker({
					position: landmark,
					title: "login"
				});
				mark.setMap(map);

				// This is a global info window...
				var infowindow = new google.maps.InfoWindow();
				// Open info window on click of marker
				google.maps.event.addListener(mark, 'click', function() {
					infowindow.setContent(mark.title);
					infowindow.open(map, mark);

				});
				});
				
				
				}
				});

				}


				
				
				}	

							
				function setup() {
				var landmark = new google.maps.LatLng(myLat, myLng);
				// Set up map
				var myOptions = {
					zoom: 13, // The larger the zoom number, the bigger the zoom
					center: landmark,
					mapTypeId: google.maps.MapTypeId.ROADMAP
				};// Create the map in the "map_canvas" <div>
				var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
				// Create a marker				
				var mark = new google.maps.Marker({
					position: landmark,
					title: "TravisIsdale"
				});
				mark.setMap(map);

				// This is a global info window...
				var infowindow = new google.maps.InfoWindow();
				// Open info window on click of marker
				google.maps.event.addListener(mark, 'click', function() {
					infowindow.setContent(mark.title);
					infowindow.open(map, mark);

				});
				}
				


			function getdata() {
		 xhr = new XMLHttpRequest();

		xhr.open('POST', 'https://secret-about-box.herokuapp.com/sendLocation', true);

		xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

			xhr.onreadystatechange = function () {

    		// do something to response

		stuff = this.responseText;
//  		console.log(stuff);

};

xhr.send('login=TravisIsdale&lat='+myLat+'&lng='+myLng+'');

				
				}
	

	
</script>


  </head>
	<body onload="initialize()">
	<div id="map_canvas" style="width:100%; height:100%"></div>

	</body>


</html>
